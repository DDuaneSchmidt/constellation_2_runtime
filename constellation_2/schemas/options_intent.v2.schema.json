{
  "$id": "https://constellation.local/schemas/options_intent.v2.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "OptionsIntent v2",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_id",
    "schema_version",
    "intent_id",
    "created_at_utc",
    "engine",
    "underlying",
    "strategy",
    "risk",
    "exit_policy",
    "selection_policy"
  ],
  "properties": {
    "schema_id": { "const": "options_intent" },
    "schema_version": { "const": "v2" },

    "intent_id": {
      "type": "string",
      "minLength": 16,
      "maxLength": 128
    },

    "created_at_utc": {
      "type": "string",
      "format": "date-time"
    },

    "engine": {
      "type": "object",
      "additionalProperties": false,
      "required": ["engine_id", "suite", "mode"],
      "properties": {
        "engine_id": {
          "type": "string",
          "enum": [
            "C2_VOL_INCOME_DEFINED_RISK_V1"
          ],
          "description": "Constellation 2.0 sleeve engine identifier (options-capable)."
        },
        "suite": {
          "type": "string",
          "enum": ["C2_OPTIONS_7"]
        },
        "mode": {
          "type": "string",
          "enum": ["PAPER", "LIVE"]
        }
      }
    },

    "underlying": {
      "type": "object",
      "additionalProperties": false,
      "required": ["symbol", "currency"],
      "properties": {
        "symbol": { "type": "string", "minLength": 1, "maxLength": 16 },
        "currency": { "type": "string", "minLength": 3, "maxLength": 3 }
      }
    },

    "strategy": {
      "type": "object",
      "additionalProperties": false,
      "required": ["structure", "right", "direction"],
      "properties": {
        "structure": { "type": "string", "enum": ["VERTICAL_SPREAD"] },
        "right": { "type": "string", "enum": ["CALL", "PUT"] },
        "direction": { "type": "string", "enum": ["CREDIT", "DEBIT"] }
      }
    },

    "risk": {
      "type": "object",
      "additionalProperties": false,
      "required": ["max_risk_usd", "max_contracts", "multiplier"],
      "properties": {
        "max_risk_usd": {
          "type": "string",
          "pattern": "^[0-9]+(\\.[0-9]+)?$"
        },
        "max_contracts": {
          "type": "integer",
          "minimum": 1,
          "maximum": 1000
        },
        "multiplier": {
          "type": "integer",
          "enum": [100]
        }
      }
    },

    "exit_policy": {
      "type": "object",
      "additionalProperties": false
    },

    "selection_policy": {
      "type": "object",
      "additionalProperties": false
    },

    "canonical_json_hash": {
      "type": ["string", "null"],
      "pattern": "^[a-f0-9]{64}$"
    }
  }
}
